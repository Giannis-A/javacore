<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java 字节码 | JAVACORE</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/javacore/img/favicon.ico">
    <script src="https://cdn.wwads.cn/js/makemoney.js" type="text/javascript"></script>
    <meta name="description" content="☕ JavaCore 是一个 Java 核心技术教程。">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    <meta name="wwads-cn-verify" content="mxqWx62nfQQ9ocT4e5DzISHzOWyF4s">
    
    <link rel="preload" href="/javacore/assets/css/0.styles.be3ea3bc.css" as="style"><link rel="preload" href="/javacore/assets/js/app.44fc03ae.js" as="script"><link rel="preload" href="/javacore/assets/js/2.aded268b.js" as="script"><link rel="preload" href="/javacore/assets/js/56.e604e971.js" as="script"><link rel="prefetch" href="/javacore/assets/js/10.b7bca9b5.js"><link rel="prefetch" href="/javacore/assets/js/11.033d3a41.js"><link rel="prefetch" href="/javacore/assets/js/12.b093ffe4.js"><link rel="prefetch" href="/javacore/assets/js/13.d561ca11.js"><link rel="prefetch" href="/javacore/assets/js/14.90010e0b.js"><link rel="prefetch" href="/javacore/assets/js/15.37509588.js"><link rel="prefetch" href="/javacore/assets/js/16.cd24ed18.js"><link rel="prefetch" href="/javacore/assets/js/17.5e555f8c.js"><link rel="prefetch" href="/javacore/assets/js/18.df926f74.js"><link rel="prefetch" href="/javacore/assets/js/19.8da3be6e.js"><link rel="prefetch" href="/javacore/assets/js/20.fb42e052.js"><link rel="prefetch" href="/javacore/assets/js/21.9d7decc0.js"><link rel="prefetch" href="/javacore/assets/js/22.f31ecff9.js"><link rel="prefetch" href="/javacore/assets/js/23.6f5cde97.js"><link rel="prefetch" href="/javacore/assets/js/24.e47f9024.js"><link rel="prefetch" href="/javacore/assets/js/25.da7e1173.js"><link rel="prefetch" href="/javacore/assets/js/26.e041331b.js"><link rel="prefetch" href="/javacore/assets/js/27.8f2ef716.js"><link rel="prefetch" href="/javacore/assets/js/28.a919e270.js"><link rel="prefetch" href="/javacore/assets/js/29.4846001f.js"><link rel="prefetch" href="/javacore/assets/js/3.d34c63b0.js"><link rel="prefetch" href="/javacore/assets/js/30.b3879734.js"><link rel="prefetch" href="/javacore/assets/js/31.e74cfb72.js"><link rel="prefetch" href="/javacore/assets/js/32.55bb9631.js"><link rel="prefetch" href="/javacore/assets/js/33.c695a6d1.js"><link rel="prefetch" href="/javacore/assets/js/34.146194b0.js"><link rel="prefetch" href="/javacore/assets/js/35.47c615d2.js"><link rel="prefetch" href="/javacore/assets/js/36.36c11b19.js"><link rel="prefetch" href="/javacore/assets/js/37.e4c911e1.js"><link rel="prefetch" href="/javacore/assets/js/38.612b0f0f.js"><link rel="prefetch" href="/javacore/assets/js/39.a8479ee6.js"><link rel="prefetch" href="/javacore/assets/js/4.884deeca.js"><link rel="prefetch" href="/javacore/assets/js/40.301701cc.js"><link rel="prefetch" href="/javacore/assets/js/41.7c62f68f.js"><link rel="prefetch" href="/javacore/assets/js/42.e9e5707c.js"><link rel="prefetch" href="/javacore/assets/js/43.2254ee61.js"><link rel="prefetch" href="/javacore/assets/js/44.24a7c914.js"><link rel="prefetch" href="/javacore/assets/js/45.4ed583ae.js"><link rel="prefetch" href="/javacore/assets/js/46.68ab70d3.js"><link rel="prefetch" href="/javacore/assets/js/47.1716d6b6.js"><link rel="prefetch" href="/javacore/assets/js/48.8069bdf8.js"><link rel="prefetch" href="/javacore/assets/js/49.d272babd.js"><link rel="prefetch" href="/javacore/assets/js/5.0d7069e0.js"><link rel="prefetch" href="/javacore/assets/js/50.7fd74f29.js"><link rel="prefetch" href="/javacore/assets/js/51.f88d9d36.js"><link rel="prefetch" href="/javacore/assets/js/52.2adc8dae.js"><link rel="prefetch" href="/javacore/assets/js/53.e90f1fda.js"><link rel="prefetch" href="/javacore/assets/js/54.8616b845.js"><link rel="prefetch" href="/javacore/assets/js/55.1fabc8f2.js"><link rel="prefetch" href="/javacore/assets/js/57.c4ac5a73.js"><link rel="prefetch" href="/javacore/assets/js/58.8e47e699.js"><link rel="prefetch" href="/javacore/assets/js/59.1c10231b.js"><link rel="prefetch" href="/javacore/assets/js/6.12339b00.js"><link rel="prefetch" href="/javacore/assets/js/60.bbcc0b2c.js"><link rel="prefetch" href="/javacore/assets/js/61.9d5ce6ce.js"><link rel="prefetch" href="/javacore/assets/js/62.db323fc4.js"><link rel="prefetch" href="/javacore/assets/js/63.ba26811b.js"><link rel="prefetch" href="/javacore/assets/js/64.b2257255.js"><link rel="prefetch" href="/javacore/assets/js/65.b3e77388.js"><link rel="prefetch" href="/javacore/assets/js/66.fbb8f12c.js"><link rel="prefetch" href="/javacore/assets/js/67.def25516.js"><link rel="prefetch" href="/javacore/assets/js/68.52669526.js"><link rel="prefetch" href="/javacore/assets/js/69.294be448.js"><link rel="prefetch" href="/javacore/assets/js/7.e7d8e450.js"><link rel="prefetch" href="/javacore/assets/js/70.8f9c4fe6.js"><link rel="prefetch" href="/javacore/assets/js/71.a20157d2.js"><link rel="prefetch" href="/javacore/assets/js/8.0ccc6dba.js"><link rel="prefetch" href="/javacore/assets/js/9.6cfc63c0.js">
    <link rel="stylesheet" href="/javacore/assets/css/0.styles.be3ea3bc.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/javacore/" class="home-link router-link-active"><img src="https://raw.githubusercontent.com/dunwu/images/master/common/dunwu-logo.png" alt="JAVACORE" class="logo"> <span class="site-name can-hide">JAVACORE</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/01.基础特性/" class="nav-link">基础特性</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/02.高级特性/" class="nav-link">高级特性</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/03.容器/" class="nav-link">容器</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/04.IO/" class="nav-link">IO</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/05.并发/" class="nav-link">并发</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/06.JVM/" class="nav-link">JVM</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">✨ Java系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎯 博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/javacore" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/01.基础特性/" class="nav-link">基础特性</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/02.高级特性/" class="nav-link">高级特性</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/03.容器/" class="nav-link">容器</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/04.IO/" class="nav-link">IO</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/05.并发/" class="nav-link">并发</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/06.JVM/" class="nav-link">JVM</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">✨ Java系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎯 博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/javacore" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaSE</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>基础特性</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>高级特性</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>容器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>IO</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>并发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>JVM</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javacore/pages/08f153/" class="sidebar-link">JVM 体系结构</a></li><li><a href="/javacore/pages/db5b69/" class="sidebar-link">Java 内存管理</a></li><li><a href="/javacore/pages/c5a5b6/" class="sidebar-link">JVM 垃圾收集</a></li><li><a href="/javacore/pages/17aad9/" class="sidebar-link">JVM 类加载</a></li><li><a href="/javacore/pages/e9eb4b/" aria-current="page" class="active sidebar-link">Java 字节码</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/javacore/pages/e9eb4b/#字节码简介" class="sidebar-link">字节码简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#什么是字节码" class="sidebar-link">什么是字节码</a></li><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#反编译字节码文件" class="sidebar-link">反编译字节码文件</a></li><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#字节码文件结构" class="sidebar-link">字节码文件结构</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#魔数" class="sidebar-link">魔数</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#版本号" class="sidebar-link">版本号</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#常量池" class="sidebar-link">常量池</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#访问标志" class="sidebar-link">访问标志</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#类索引、父类索引、接口索引" class="sidebar-link">类索引、父类索引、接口索引</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#字段表" class="sidebar-link">字段表</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#方法表" class="sidebar-link">方法表</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#属性表集合" class="sidebar-link">属性表集合</a></li><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#字节码指令" class="sidebar-link">字节码指令</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/javacore/pages/e9eb4b/#字节码增强" class="sidebar-link">字节码增强</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#asm" class="sidebar-link">Asm</a></li><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#javassist" class="sidebar-link">Javassist</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/javacore/pages/e9eb4b/#运行时类的重载" class="sidebar-link">运行时类的重载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#instrument" class="sidebar-link">Instrument</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/javacore/pages/e9eb4b/#javaagent" class="sidebar-link">JavaAgent</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#java-agent-技术简介" class="sidebar-link">Java Agent 技术简介</a></li><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#java-agent-功能介绍" class="sidebar-link">Java Agent 功能介绍</a></li><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#java-agent-实现原理" class="sidebar-link">Java Agent 实现原理</a></li><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#java-agent-案例" class="sidebar-link">Java Agent 案例</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#加载-java-字节码之前拦截" class="sidebar-link">加载 Java 字节码之前拦截</a></li><li class="sidebar-sub-header level5"><a href="/javacore/pages/e9eb4b/#app-项目" class="sidebar-link">App 项目</a></li><li class="sidebar-sub-header level5"><a href="/javacore/pages/e9eb4b/#agent-项目" class="sidebar-link">Agent 项目</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#运行时拦截-jdk-1-6-及以上" class="sidebar-link">运行时拦截（JDK 1.6 及以上）</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/javacore/pages/e9eb4b/#字节码工具" class="sidebar-link">字节码工具</a></li><li class="sidebar-sub-header level2"><a href="/javacore/pages/e9eb4b/#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/javacore/pages/c590ae/" class="sidebar-link">JVM 命令行工具</a></li><li><a href="/javacore/pages/43a8e5/" class="sidebar-link">JVM GUI 工具</a></li><li><a href="/javacore/pages/9cb60a/" class="sidebar-link">JVM 实战</a></li><li><a href="/javacore/pages/84f329/" class="sidebar-link">Java 故障诊断</a></li></ul></section></li><li><a href="/javacore/pages/5f886e/" class="sidebar-link">Java 面试总结</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/javacore/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/javacore/categories/?category=Java" title="分类" data-v-06225672>Java</a></li><li data-v-06225672><a href="/javacore/categories/?category=JavaSE" title="分类" data-v-06225672>JavaSE</a></li><li data-v-06225672><a href="/javacore/categories/?category=JVM" title="分类" data-v-06225672>JVM</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/dunwu" target="_blank" title="作者" class="beLink" data-v-06225672>dunwu</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2019-10-28</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Java 字节码<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="java-字节码"><a href="#java-字节码" class="header-anchor">#</a> Java 字节码</h1> <h2 id="字节码简介"><a href="#字节码简介" class="header-anchor">#</a> 字节码简介</h2> <h3 id="什么是字节码"><a href="#什么是字节码" class="header-anchor">#</a> 什么是字节码</h3> <p>Java 字节码是 Java 虚拟机执行的一种指令格式。之所以被称之为字节码，是因为：<strong>Java 字节码文件（<code>.class</code>）是一种以 8 位字节为基础单位的二进制流文件</strong>，各个数据项严格按照顺序紧凑地排列在 .class 文件中，中间没有添加任何分隔符。<strong>整个 .class 文件本质上就是一张表</strong>。</p> <p>Java 能做到 “<strong>一次编译，到处运行</strong>”，一是因为 JVM 针对各种操作系统、平台都进行了定制；二是因为无论在什么平台，都可以编译生成固定格式的 Java 字节码文件（<code>.class</code>）。</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20230419203137.png" alt=""></p> <h3 id="反编译字节码文件"><a href="#反编译字节码文件" class="header-anchor">#</a> 反编译字节码文件</h3> <p>我们通过一个示例来讲解如何反编译字节码文件。</p> <p>（1）首先，创建一个 <code>Demo.java</code> 文件，内容如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>（2）执行 <code>javac Demo.java</code>，编译 <code>Demo.java</code> 文件，在当前路径下生成一个 <code>Demo.class</code> 文件。</p> <p>文件内容如下，是一堆 16 进制数：</p> <div class="language- extra-class"><pre class="language-text"><code>ca fe ba be 20 20 20 34 20 1d 0a 20 06 20 0f 09 20 10 20 11 08 20 12 0a 20 13 20 14 07 20 15 07 20 16 01 20 06 3c 69 6e 69 74 3e 01 20 03 28 29 56 01 20 04 43 6f 64 65 01 20 0f 4c 69 6e 65 4e 75 6d 62 65 72 54 61 62 6c 65 01 20 04 6d 61 69 6e 01 20 16 28 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b 29 56 01 20 0a 53 6f 75 72 63 65 46 69 6c 65 01 20 09 44 65 6d 6f 2e 6a 61 76 61 0c 20 07 20 08 07 20 17 0c 20 18 20 19 01 20 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64 07 20 1a 0c 20 1b 20 1c 01 20 26 69 6f 2f 67 69 74 68 75 62 2f 64 75 6e 77 75 2f 6a 61 76 61 63 6f 72 65 2f 62 79 74 65 63 6f 64 65 2f 44 65 6d 6f 01 20 10 6a 61 76 61 2f 6c 61 6e 67 2f 4f 62 6a 65 63 74 01 20 10 6a 61 76 61 2f 6c 61 6e 67 2f 53 79 73 74 65 6d 01 20 03 6f 75 74 01 20 15 4c 6a 61 76 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d 3b 01 20 13 6a 61 76 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d 01 20 07 70 72 69 6e 74 6c 6e 01 20 15 28 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b 29 56 20 21 20 05 20 06 20 20 20 20 20 02 20 01 20 07 20 08 20 01 20 09 20 20 20 1d 20 01 20 01 20 20 20 05 2a b7 20 01 b1 20 20 20 01 20 0a 20 20 20 06 20 01 20 20 20 03 20 09 20 0b 20 0c 20 01 20 09 20 20 20 25 20 02 20 01 20 20 20 09 b2 20 02 12 03 b6 20 04 b1 20 20 20 01 20 0a 20 20 20 0a 20 02 20 20 20 06 20 08 20 07 20 01 20 0d 20 20 20 02 20 0e
</code></pre></div><p>前面已经提过：Java 字节码文件（<code>.class</code>）是一种以 8 位字节为基础单位的二进制流文件，各个数据项严格按照顺序紧凑地排列在 .class 文件中，中间没有添加任何分隔符。</p> <p>（3）使用到 Java 内置的反编译工具 <code>javap</code> 可以<strong>反编译</strong>字节码文件。</p> <p>执行 <code>javap -verbose -p Demo.class</code>，控制台会输出相对而言，可以理解的指令。输出内容大致如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Classfile</span> <span class="token operator">/</span><span class="token class-name">D</span><span class="token operator">:</span><span class="token operator">/</span><span class="token class-name">Workspace</span><span class="token operator">/</span><span class="token class-name">Demo</span><span class="token punctuation">.</span><span class="token keyword">class</span>
  <span class="token class-name">Last</span> modified <span class="token number">2023</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">;</span> size <span class="token number">447</span> bytes
  <span class="token constant">MD5</span> checksum <span class="token number">0</span>baafe4215fe2bd2e51b48d51fe563a3
  <span class="token class-name">Compiled</span> from <span class="token string">&quot;Demo.java&quot;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>bytecode<span class="token punctuation">.</span></span>Demo</span>
  minor version<span class="token operator">:</span> <span class="token number">0</span>
  major version<span class="token operator">:</span> <span class="token number">52</span>
  flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token constant">ACC_SUPER</span>
<span class="token class-name">Constant</span> pool<span class="token operator">:</span>
   #<span class="token number">1</span> <span class="token operator">=</span> <span class="token class-name">Methodref</span>          #<span class="token number">6.</span>#<span class="token number">15</span>         <span class="token comment">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span>
   #<span class="token number">2</span> <span class="token operator">=</span> <span class="token class-name">Fieldref</span>           #<span class="token number">16.</span>#<span class="token number">17</span>        <span class="token comment">// java/lang/System.out:Ljava/io/PrintStream;</span>
   #<span class="token number">3</span> <span class="token operator">=</span> <span class="token class-name">String</span>             #<span class="token number">18</span>            <span class="token comment">// hello world</span>
   #<span class="token number">4</span> <span class="token operator">=</span> <span class="token class-name">Methodref</span>          #<span class="token number">19.</span>#<span class="token number">20</span>        <span class="token comment">// java/io/PrintStream.println:(Ljava/lang/String;)V</span>
   #<span class="token number">5</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">21</span>            <span class="token comment">// io/github/dunwu/javacore/bytecode/Demo</span>
   #<span class="token number">6</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">22</span>            <span class="token comment">// java/lang/Object</span>
   #<span class="token number">7</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span>
   #<span class="token number">8</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
   #<span class="token number">9</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">Code</span>
  #<span class="token number">10</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">LineNumberTable</span>
  #<span class="token number">11</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               main
  #<span class="token number">12</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span>
  #<span class="token number">13</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">SourceFile</span>
  #<span class="token number">14</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">Demo</span><span class="token punctuation">.</span>java
  #<span class="token number">15</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">7</span><span class="token operator">:</span>#<span class="token number">8</span>          <span class="token comment">// &quot;&lt;init&gt;&quot;:()V</span>
  #<span class="token number">16</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">23</span>            <span class="token comment">// java/lang/System</span>
  #<span class="token number">17</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">24</span><span class="token operator">:</span>#<span class="token number">25</span>        <span class="token comment">// out:Ljava/io/PrintStream;</span>
  #<span class="token number">18</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               hello world
  #<span class="token number">19</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">26</span>            <span class="token comment">// java/io/PrintStream</span>
  #<span class="token number">20</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">27</span><span class="token operator">:</span>#<span class="token number">28</span>        <span class="token comment">// println:(Ljava/lang/String;)V</span>
  #<span class="token number">21</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               io<span class="token operator">/</span>github<span class="token operator">/</span>dunwu<span class="token operator">/</span>javacore<span class="token operator">/</span>bytecode<span class="token operator">/</span><span class="token class-name">Demo</span>
  #<span class="token number">22</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span>
  #<span class="token number">23</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span>
  #<span class="token number">24</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               out
  #<span class="token number">25</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span>
  #<span class="token number">26</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span>
  #<span class="token number">27</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               println
  #<span class="token number">28</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>bytecode<span class="token punctuation">.</span></span>Demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">1</span>
         <span class="token number">0</span><span class="token operator">:</span> aload_0
         <span class="token number">1</span><span class="token operator">:</span> invokespecial #<span class="token number">1</span>                  <span class="token comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span>
         <span class="token number">4</span><span class="token operator">:</span> <span class="token keyword">return</span>
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">3</span><span class="token operator">:</span> <span class="token number">0</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token constant">ACC_STATIC</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">1</span>
         <span class="token number">0</span><span class="token operator">:</span> getstatic     #<span class="token number">2</span>                  <span class="token comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
         <span class="token number">3</span><span class="token operator">:</span> ldc           #<span class="token number">3</span>                  <span class="token comment">// String hello world</span>
         <span class="token number">5</span><span class="token operator">:</span> invokevirtual #<span class="token number">4</span>                  <span class="token comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
         <span class="token number">8</span><span class="token operator">:</span> <span class="token keyword">return</span>
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">6</span><span class="token operator">:</span> <span class="token number">0</span>
        line <span class="token number">7</span><span class="token operator">:</span> <span class="token number">8</span>
<span class="token punctuation">}</span>
<span class="token class-name">SourceFile</span><span class="token operator">:</span> <span class="token string">&quot;Demo.java&quot;</span>
</code></pre></div><blockquote><p>提示：通过 <code>javap -help</code> 可了解 <code>javap</code> 的基本用法。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>用法: javap <span class="token operator">&lt;</span>options<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>classes<span class="token operator">&gt;</span>
其中, 可能的选项包括:
  <span class="token parameter variable">-help</span>  <span class="token parameter variable">--help</span>  -?        输出此用法消息
  <span class="token parameter variable">-version</span>                 版本信息
    <span class="token parameter variable">-v</span>  <span class="token parameter variable">-verbose</span>             输出附加信息
    <span class="token parameter variable">-l</span>                       输出行号和本地变量表
    <span class="token parameter variable">-public</span>                  仅显示公共类和成员
    <span class="token parameter variable">-protected</span>               显示受保护的/公共类和成员
    <span class="token parameter variable">-package</span>                 显示程序包/受保护的/公共类
                             和成员 <span class="token punctuation">(</span>默认<span class="token punctuation">)</span>
    <span class="token parameter variable">-p</span>  <span class="token parameter variable">-private</span>             显示所有类和成员
     <span class="token parameter variable">-c</span>                       对代码进行反汇编
    <span class="token parameter variable">-s</span>                       输出内部类型签名
    <span class="token parameter variable">-sysinfo</span>                 显示正在处理的类的
                             系统信息 <span class="token punctuation">(</span>路径, 大小, 日期, MD5 散列<span class="token punctuation">)</span>
    <span class="token parameter variable">-constants</span>               显示最终常量
     <span class="token parameter variable">-classpath</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span>        指定查找用户类文件的位置
    <span class="token parameter variable">-cp</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span>               指定查找用户类文件的位置
    <span class="token parameter variable">-bootclasspath</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span>    覆盖引导类文件的位置
</code></pre></div></blockquote> <h3 id="字节码文件结构"><a href="#字节码文件结构" class="header-anchor">#</a> 字节码文件结构</h3> <p>字节码看似杂乱无序，实际上是由严格的格式要求组成的。</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20230419154033.png" alt=""></p> <h4 id="魔数"><a href="#魔数" class="header-anchor">#</a> 魔数</h4> <p>每个 <code>.class</code> 文件的头 4 个字节称为 <strong><code>魔数（magic_number）</code></strong>，它的唯一作用是确定这个文件是否为一个能被虚拟机接收的 <code>.class</code> 文件。魔数的固定值为：<code>0xCAFEBABE</code>。</p> <h4 id="版本号"><a href="#版本号" class="header-anchor">#</a> 版本号</h4> <p>版本号（version）有 4 个字节，<strong>前两个字节表示次版本号（Minor Version），后两个字节表示主版本号（Major Version）</strong>。</p> <p>举例来说，如果版本号为：“00 00 00 34”。那么，次版本号转化为十进制为 0，主版本号转化为十进制为 52，在 Oracle 官网中查询序号 52 对应的主版本号为 1.8，所以编译该文件的 Java 版本号为 1.8.0。</p> <h4 id="常量池"><a href="#常量池" class="header-anchor">#</a> 常量池</h4> <p>紧接着主版本号之后的字节为常量池（constant_pool），常量池可以理解为 <code>.class</code> 文件中的资源仓库。</p> <p>常量池整体上分为两部分：常量池计数器以及常量池数据区</p> <ul><li><p><strong>常量池计数器（constant_pool_count）</strong> - 由于常量的数量不固定，所以需要先放置两个字节来表示常量池容量计数值。</p></li> <li><p><strong>常量池数据区</strong> - 数据区的每一项常量都是一个表，且结构各不相同。</p></li></ul> <p>常量池主要存放两类常量：</p> <ul><li><strong>字面量</strong> - 如文本字符串、声明为 <code>final</code> 的常量值。</li> <li><strong>符号引用</strong> <ul><li>类和接口的全限定名</li> <li>字段的名称和描述符</li> <li>方法的名称和描述符</li></ul></li></ul> <h4 id="访问标志"><a href="#访问标志" class="header-anchor">#</a> 访问标志</h4> <p>紧接着常量池的 2 个字节代表访问标志（access_flags），这个标志<strong>用于识别一些类或者接口的访问信息</strong>，描述该 Class 是类还是接口，以及是否被 <code>public</code>、<code>abstract</code>、<code>final</code> 等修饰符修饰。</p> <p>访问标志有以下类型：</p> <table><thead><tr><th>标志名称</th> <th>标志值</th> <th>含义</th></tr></thead> <tbody><tr><td><strong>ACC_PUBLIC</strong></td> <td>0x0001</td> <td>是否为 Public 类型</td></tr> <tr><td><strong>ACC_FINAL</strong></td> <td>0x0010</td> <td>是否被声明为 final，只有类可以设置</td></tr> <tr><td><strong>ACC_SUPER</strong></td> <td>0x0020</td> <td>是否允许使用 invokespecial 字节码指令的新语义．</td></tr> <tr><td><strong>ACC_INTERFACE</strong></td> <td>0x0200</td> <td>标志这是一个接口</td></tr> <tr><td><strong>ACC_ABSTRACT</strong></td> <td>0x0400</td> <td>是否为 abstract 类型，对于接口或者抽象类来说， 次标志值为真，其他类型为假</td></tr> <tr><td><strong>ACC_SYNTHETIC</strong></td> <td>0x1000</td> <td>标志这个类并非由用户代码产生</td></tr> <tr><td><strong>ACC_ANNOTATION</strong></td> <td>0x2000</td> <td>标志这是一个注解</td></tr> <tr><td><strong>ACC_ENUM</strong></td> <td>0x4000</td> <td>标志这是一个枚举</td></tr></tbody></table> <h4 id="类索引、父类索引、接口索引"><a href="#类索引、父类索引、接口索引" class="header-anchor">#</a> 类索引、父类索引、接口索引</h4> <p>类索引（this_class）和父类索引都是一个 u2 类型的数据，而接口索引集合是一组 u2 类型的数据的集合。<strong>.class 文件中由这 3 项数据来确定这个类的继承关系</strong>。</p> <h4 id="字段表"><a href="#字段表" class="header-anchor">#</a> 字段表</h4> <p><strong>字段表用于描述类和接口中声明的变量</strong>。包含类级变量以及实例级变量，但是不包含方法内部声明的局部变量。</p> <p>字段表也分为两部分，第一部分为两个字节，描述字段个数；第二部分是每个字段的详细信息 fields_info。</p> <h4 id="方法表"><a href="#方法表" class="header-anchor">#</a> 方法表</h4> <p>字段表结束后为方法表，方法表的结构如同字段表一样，依次包括了访问标志、名称索引、描述符索引、属性表集合几项。</p> <h4 id="属性表集合"><a href="#属性表集合" class="header-anchor">#</a> 属性表集合</h4> <p>属性表集合存放了在该文件中类或接口所定义属性的基本信息。</p> <h3 id="字节码指令"><a href="#字节码指令" class="header-anchor">#</a> 字节码指令</h3> <p>字节码指令由一个字节长度的、代表着某种特定操作含义的数字（称为操作码，Opcode）以及跟随其后的零到多个代表此操作所需参数（Operands）而构成。由于 JVM 采用面向操作数栈架构而不是寄存器架构，所以大多数的指令都不包括操作数，只有一个操作码。</p> <p>JVM 操作码的长度为 1 个字节，因此指令集的操作码最多只有 256 个。</p> <p>字节码操作大致分为 9 类：</p> <ul><li>加载和存储指令</li> <li>运算指令</li> <li>类型转换指令</li> <li>对象创建与访问指令</li> <li>操作数栈管理指令</li> <li>控制转移指令</li> <li>方法调用和返回指令</li> <li>异常处理指令</li> <li>同步指令</li></ul> <h2 id="字节码增强"><a href="#字节码增强" class="header-anchor">#</a> 字节码增强</h2> <p>字节码增强技术就是一类对现有字节码进行修改或者动态生成全新字节码文件的技术。</p> <p>常见的字节码增强框架有：</p> <ul><li><a href="https://asm.ow2.io/" target="_blank" rel="noopener noreferrer">asm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> -</li> <li><a href="https://github.com/jboss-javassist/javassist" target="_blank" rel="noopener noreferrer">javassist<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - Javassist 的是通过控制底层字节码来实现动态代理，不需要反射完成调用，所以性能肯定比 JDK 的动态代理方式性能要好。</li> <li><a href="https://github.com/raphw/byte-buddy" target="_blank" rel="noopener noreferrer">Byte Buddy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - Byte Buddy 则属于后起之秀，在很多优秀的项目中，像 Spring、Jackson 都用到了 Byte Buddy 来完成底层代理。相比 Javassist，Byte Buddy 提供了更容易操作的 API，编写的代码可读性更高。更重要的是，生成的代理类执行速度比 Javassist 更快。</li></ul> <h3 id="asm"><a href="#asm" class="header-anchor">#</a> Asm</h3> <p>对于需要手动操纵字节码的需求，可以使用 Asm，它可以直接生产 <code>.class</code>字节码文件，也可以在类被加载入 JVM 之前动态修改类行为。</p> <p>Asm 的应用场景有 AOP（Cglib 就是基于 Asm）、热部署、修改其他 jar 包中的类等。当然，涉及到如此底层的步骤，实现起来也比较麻烦。</p> <p>Asm 有两类 API：核心 API 和树形 API</p> <ul><li><strong>核心 API</strong> - Asm Core API 可以类比解析 XML 文件中的 SAX 方式，不需要把这个类的整个结构读取进来，就可以用流式的方法来处理字节码文件。好处是非常节约内存，但是编程难度较大。然而出于性能考虑，一般情况下编程都使用 Core API。在 Core API 中有以下几个关键类：
<ul><li><strong><code>ClassReader</code></strong> - 用于读取已经编译好的 .class 文件。</li> <li><strong><code>ClassWriter</code></strong> - 用于重新构建编译后的类，如修改类名、属性以及方法，也可以生成新的类的字节码文件。</li> <li>各种 <strong><code>Visitor</code></strong> 类 - CoreAPI 根据字节码从上到下依次处理，对于字节码文件中不同的区域有不同的 Visitor，比如用于访问方法的 MethodVisitor、用于访问类变量的 FieldVisitor、用于访问注解的 AnnotationVisitor 等。为了实现 AOP，重点要使用的是 MethodVisitor。</li></ul></li> <li><strong>树形 API</strong> - Asm Tree API 可以类比解析 XML 文件中的 DOM 方式，把整个类的结构读取到内存中，缺点是消耗内存多，但是编程比较简单。TreeApi 不同于 CoreAPI，TreeAPI 通过各种 Node 类来映射字节码的各个区域，类比 DOM 节点，就可以很好地理解这种编程方式。</li></ul> <h3 id="javassist"><a href="#javassist" class="header-anchor">#</a> Javassist</h3> <p>利用 Javassist 实现字节码增强时，可以无须关注字节码刻板的结构，其优点就在于编程简单。直接使用 java 编码的形式，而不需要了解虚拟机指令，就能动态改变类的结构或者动态生成类。</p> <p>其核心类如下：</p> <ul><li><code>CtClass（compile-time class）</code> - 编译时类信息。它是一个 <code>class</code> 文件在代码中的抽象，可以通过一个类的全限定名来获取一个 <code>CtClass</code> 对象，用来表示这个类文件。</li> <li><code>ClassPool</code> - <code>ClassPool</code> 可以看成一张保存 <code>CtClass</code> 信息的 HashTable，key 为类名，value 为类名对应的 <code>CtClass</code> 对象。当我们需要对某个类进行修改时，就是通过 <code>pool.getCtClass(&quot;className&quot;)</code> 方法从 pool 中获取到相应的 <code>CtClass</code>。</li> <li><code>CtMethod</code>、<code>CtField</code> - 对应的是类中的方法和属性。</li></ul> <h2 id="运行时类的重载"><a href="#运行时类的重载" class="header-anchor">#</a> 运行时类的重载</h2> <h3 id="instrument"><a href="#instrument" class="header-anchor">#</a> Instrument</h3> <p>instrument 是 JVM 提供的一个可以修改已加载类的类库，专门为 Java 语言编写的插桩服务提供支持。它需要依赖 JVMTI 的 Attach API 机制实现。在 JDK 1.6 以前，instrument 只能在 JVM 刚启动开始加载类时生效，而在 JDK 1.6 之后，instrument 支持了在运行时对类定义的修改。要使用 instrument 的类修改功能，我们需要实现它提供的 ClassFileTransformer 接口，定义一个类文件转换器。接口中的 transform()方法会在类文件被加载时调用，而在 transform 方法里，可以利用 ASM 或 Javassist 对传入的字节码进行改写或替换，生成新的字节码数组后返回。</p> <h2 id="javaagent"><a href="#javaagent" class="header-anchor">#</a> JavaAgent</h2> <p>Javaagent 是什么？</p> <p>Javaagent 是 java 命令的一个参数。参数 javaagent 可以用于指定一个 jar 包，它利用 JVM 提供的 Instrumentation API 来更改加载 JVM 中的现有字节码。</p> <ol><li>这个 jar 包的 MANIFEST.MF 文件必须指定 Premain-Class 项。</li> <li>Premain-Class 指定的那个类必须实现 premain() 方法。</li></ol> <p>premain 方法，从字面上理解，就是运行在 main 函数之前的的类。当 Java 虚拟机启动时，在执行 main 函数之前，JVM 会先运行<code>-javaagent</code>所指定 jar 包内 Premain-Class 这个类的 premain 方法 。</p> <p>在命令行输入 <code>java</code>可以看到相应的参数，其中有 和 java agent 相关的：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>-agentlib:<span class="token operator">&lt;</span>libname<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>选项<span class="token operator">&gt;</span><span class="token punctuation">]</span>
			  加载本机代理库 <span class="token operator">&lt;</span>libname<span class="token operator">&gt;</span>, 例如 <span class="token parameter variable">-agentlib:hprof</span>
			  另请参阅 <span class="token parameter variable">-agentlib:jdwp</span><span class="token operator">=</span>help 和 <span class="token parameter variable">-agentlib:hprof</span><span class="token operator">=</span>help
-agentpath:<span class="token operator">&lt;</span>pathname<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>选项<span class="token operator">&gt;</span><span class="token punctuation">]</span>
			  按完整路径名加载本机代理库
-javaagent:<span class="token operator">&lt;</span>jarpath<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>选项<span class="token operator">&gt;</span><span class="token punctuation">]</span>
			  加载 Java 编程语言代理, 请参阅 java.lang.instrument
</code></pre></div><h3 id="java-agent-技术简介"><a href="#java-agent-技术简介" class="header-anchor">#</a> Java Agent 技术简介</h3> <p>Java Agent 直译为 Java 代理，也常常被称为 Java 探针技术。</p> <p>Java Agent 是在 JDK1.5 引入的，是一种可以动态修改 Java 字节码的技术。Java 中的类编译后形成字节码被 JVM 执行，在 JVM 在执行这些字节码之前获取这些字节码的信息，并且通过字节码转换器对这些字节码进行修改，以此来完成一些额外的功能。</p> <p>Java Agent 是一个不能独立运行 jar 包，它通过依附于目标程序的 JVM 进程，进行工作。启动时只需要在目标程序的启动参数中添加-javaagent 参数添加 ClassFileTransformer 字节码转换器，相当于在 main 方法前加了一个拦截器。</p> <h3 id="java-agent-功能介绍"><a href="#java-agent-功能介绍" class="header-anchor">#</a> Java Agent 功能介绍</h3> <p>Java Agent 主要有以下功能</p> <ul><li>Java Agent 能够在加载 Java 字节码之前拦截并对字节码进行修改;</li> <li>Java Agent 能够在 Jvm 运行期间修改已经加载的字节码;</li></ul> <p>Java Agent 的应用场景</p> <ul><li>IDE 的调试功能，例如 Eclipse、IntelliJ IDEA ；</li> <li>热部署功能，例如 JRebel、XRebel、spring-loaded；</li> <li>各种线上诊断工具，例如 Btrace、Greys，还有阿里的 Arthas；</li> <li>各种性能分析工具，例如 Visual VM、JConsole 等；</li> <li>全链路性能检测工具，例如 Skywalking、Pinpoint 等；</li></ul> <h3 id="java-agent-实现原理"><a href="#java-agent-实现原理" class="header-anchor">#</a> Java Agent 实现原理</h3> <p>在了解 Java Agent 的实现原理之前，需要对 Java 类加载机制有一个较为清晰的认知。一种是在 man 方法执行之前，通过 premain 来执行，另一种是程序运行中修改，需通过 JVM 中的 Attach 实现，Attach 的实现原理是基于 JVMTI。</p> <p>主要是在类加载之前，进行拦截，对字节码修改</p> <p>下面我们分别介绍一下这些关键术语：</p> <ul><li><p><strong>JVMTI</strong> 就是 JVM Tool Interface，是 JVM 暴露出来给用户扩展使用的接口集合，JVMTI 是基于事件驱动的，JVM 每执行一定的逻辑就会触发一些事件的回调接口，通过这些回调接口，用户可以自行扩展</p> <p>JVMTI 是实现 Debugger、Profiler、Monitor、Thread Analyser 等工具的统一基础，在主流 Java 虚拟机中都有实现</p></li> <li><p><strong>JVMTIAgent</strong>是一个动态库，利用 JVMTI 暴露出来的一些接口来干一些我们想做、但是正常情况下又做不到的事情，不过为了和普通的动态库进行区分，它一般会实现如下的一个或者多个函数：</p> <ul><li>Agent_OnLoad 函数，如果 agent 是在启动时加载的，通过 JVM 参数设置</li> <li>Agent_OnAttach 函数，如果 agent 不是在启动时加载的，而是我们先 attach 到目标进程上，然后给对应的目标进程发送 load 命令来加载，则在加载过程中会调用 Agent_OnAttach 函数</li> <li>Agent_OnUnload 函数，在 agent 卸载时调用</li></ul></li> <li><p><strong>javaagent</strong> 依赖于 instrument 的 JVMTIAgent（Linux 下对应的动态库是 libinstrument.so），还有个别名叫 JPLISAgent(Java Programming Language Instrumentation Services Agent)，专门为 Java 语言编写的插桩服务提供支持的</p></li> <li><p><strong>instrument</strong> 实现了 Agent_OnLoad 和 Agent_OnAttach 两方法，也就是说在使用时，agent 既可以在启动时加载，也可以在运行时动态加载。其中启动时加载还可以通过类似-javaagent:jar 包路径的方式来间接加载 instrument agent，运行时动态加载依赖的是 JVM 的 attach 机制，通过发送 load 命令来加载 agent</p></li> <li><p><strong>JVM Attach</strong> 是指 JVM 提供的一种进程间通信的功能，能让一个进程传命令给另一个进程，并进行一些内部的操作，比如进行线程 dump，那么就需要执行 jstack 进行，然后把 pid 等参数传递给需要 dump 的线程来执行</p></li></ul> <h3 id="java-agent-案例"><a href="#java-agent-案例" class="header-anchor">#</a> Java Agent 案例</h3> <h4 id="加载-java-字节码之前拦截"><a href="#加载-java-字节码之前拦截" class="header-anchor">#</a> 加载 Java 字节码之前拦截</h4> <h5 id="app-项目"><a href="#app-项目" class="header-anchor">#</a> App 项目</h5> <p>（1）创建一个名为 <code>javacore-javaagent-app</code> 的 maven 工程</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.dunwu.javacore<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javacore-javaagent-app<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>JavaCore :: JavaAgent :: App<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>${java.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>${java.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>（2）创建一个应用启动类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppMain</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;APP 启动！！！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AppInit</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>（3）创建一个模拟应用初始化的类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppInit</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;APP初始化中...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>（4）输出</p> <div class="language- extra-class"><pre class="language-text"><code>APP 启动！！！
APP初始化中...
</code></pre></div><h5 id="agent-项目"><a href="#agent-项目" class="header-anchor">#</a> Agent 项目</h5> <p>（1）创建一个名为 <code>javacore-javaagent-agent</code> 的 maven 工程</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>project xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> xmlns<span class="token operator">=</span><span class="token string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
  xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span><span class="token string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>modelVersion<span class="token punctuation">&gt;</span></span><span class="token number">4.0</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>modelVersion<span class="token operator">&gt;</span>

  <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>javacore<span class="token operator">-</span>javaagent<span class="token operator">-</span>agent<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.0</span><span class="token number">.1</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span><span class="token class-name">JavaCore</span> <span class="token operator">::</span> <span class="token class-name">JavaAgent</span> <span class="token operator">::</span> <span class="token class-name">Agent</span><span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>

  <span class="token generics"><span class="token punctuation">&lt;</span>properties<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>project<span class="token punctuation">.</span>build<span class="token punctuation">.</span>sourceEncoding<span class="token punctuation">&gt;</span></span><span class="token constant">UTF</span><span class="token operator">-</span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>project<span class="token punctuation">.</span>build<span class="token punctuation">.</span>sourceEncoding<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>java<span class="token punctuation">.</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.8</span><span class="token operator">&lt;</span><span class="token operator">/</span>java<span class="token punctuation">.</span>version<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>source<span class="token punctuation">&gt;</span></span>$<span class="token punctuation">{</span>java<span class="token punctuation">.</span>version<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>source<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>target<span class="token punctuation">&gt;</span></span>$<span class="token punctuation">{</span>java<span class="token punctuation">.</span>version<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>target<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>properties<span class="token operator">&gt;</span>

  <span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">&gt;</span></span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>javaagent 工具包<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
      <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>javassist<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>javassist<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">3.26</span><span class="token number">.0</span><span class="token operator">-</span><span class="token constant">GA</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>

  <span class="token generics"><span class="token punctuation">&lt;</span>build<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>plugins<span class="token punctuation">&gt;</span></span>
      <span class="token generics"><span class="token punctuation">&lt;</span>plugin<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>maven<span class="token punctuation">.</span>plugins<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>maven<span class="token operator">-</span>compiler<span class="token operator">-</span>plugin<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">3.5</span><span class="token number">.1</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>指定 maven 编译的 jdk 版本。若不指定，maven3 默认用 jdk <span class="token number">1.5</span>；maven2 默认用 jdk1<span class="token punctuation">.</span><span class="token number">3</span><span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>configuration<span class="token punctuation">&gt;</span></span>
          <span class="token generics"><span class="token punctuation">&lt;</span>source<span class="token punctuation">&gt;</span></span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>source<span class="token operator">&gt;</span>
          <span class="token generics"><span class="token punctuation">&lt;</span>target<span class="token punctuation">&gt;</span></span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>target<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>plugin<span class="token operator">&gt;</span>

      <span class="token generics"><span class="token punctuation">&lt;</span>plugin<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>maven<span class="token punctuation">.</span>plugins<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>maven<span class="token operator">-</span>jar<span class="token operator">-</span>plugin<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">3.2</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>configuration<span class="token punctuation">&gt;</span></span>
          <span class="token generics"><span class="token punctuation">&lt;</span>archive<span class="token punctuation">&gt;</span></span>
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>自动添加<span class="token constant">META</span><span class="token operator">-</span><span class="token constant">INF</span><span class="token operator">/</span><span class="token constant">MANIFEST</span><span class="token punctuation">.</span><span class="token constant">MF</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>manifest<span class="token punctuation">&gt;</span></span>
              <span class="token generics"><span class="token punctuation">&lt;</span>addClasspath<span class="token punctuation">&gt;</span></span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span>addClasspath<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>manifest<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>manifestEntries<span class="token punctuation">&gt;</span></span>
              <span class="token operator">&lt;</span><span class="token class-name">Menifest</span><span class="token operator">-</span><span class="token class-name">Version</span><span class="token operator">&gt;</span><span class="token number">1.0</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token class-name">Menifest</span><span class="token operator">-</span><span class="token class-name">Version</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span><span class="token class-name">Premain</span><span class="token operator">-</span><span class="token class-name">Class</span><span class="token operator">&gt;</span><span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>javaagent<span class="token punctuation">.</span></span>RunTimeAgent</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token class-name">Premain</span><span class="token operator">-</span><span class="token class-name">Class</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span><span class="token class-name">Can</span><span class="token operator">-</span><span class="token class-name">Redefine</span><span class="token operator">-</span><span class="token class-name">Classes</span><span class="token operator">&gt;</span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token class-name">Can</span><span class="token operator">-</span><span class="token class-name">Redefine</span><span class="token operator">-</span><span class="token class-name">Classes</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span><span class="token class-name">Can</span><span class="token operator">-</span><span class="token class-name">Retransform</span><span class="token operator">-</span><span class="token class-name">Classes</span><span class="token operator">&gt;</span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token class-name">Can</span><span class="token operator">-</span><span class="token class-name">Retransform</span><span class="token operator">-</span><span class="token class-name">Classes</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>manifestEntries<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>archive<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>plugin<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>plugins<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>build<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>project<span class="token operator">&gt;</span>
</code></pre></div><p>（2）创建一个 Agent 启动类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunTimeAgent</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">premain</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">,</span> <span class="token class-name">Instrumentation</span> instrumentation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;探针启动！！！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;探针传入参数：&quot;</span> <span class="token operator">+</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        instrumentation<span class="token punctuation">.</span><span class="token function">addTransformer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunTimeTransformer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里每个类加载的时候都会走这个方法，我们可以通过 className 进行指定类的拦截，然后借助 javassist 这个工具，进行对 Class 的处理，这里的思想和反射类似，但是要比反射功能更加强大，可以动态修改字节码。</p> <p>（3）使用 javassist 拦截指定类，并进行代码增强</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>javaagent</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">ClassPool</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">CtClass</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">CtMethod</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>instrument<span class="token punctuation">.</span></span><span class="token class-name">ClassFileTransformer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>instrument<span class="token punctuation">.</span></span><span class="token class-name">IllegalClassFormatException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">ProtectionDomain</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunTimeTransformer</span> <span class="token keyword">implements</span> <span class="token class-name">ClassFileTransformer</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">INJECTED_CLASS</span> <span class="token operator">=</span> <span class="token string">&quot;io.github.dunwu.javacore.javaagent.AppInit&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> loader<span class="token punctuation">,</span> <span class="token class-name">String</span> className<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> classBeingRedefined<span class="token punctuation">,</span>
        <span class="token class-name">ProtectionDomain</span> protectionDomain<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classfileBuffer<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalClassFormatException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> realClassName <span class="token operator">=</span> className<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>realClassName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token constant">INJECTED_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;拦截到的类名：&quot;</span> <span class="token operator">+</span> realClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">CtClass</span> ctClass<span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// 使用javassist,获取字节码类</span>
                <span class="token class-name">ClassPool</span> classPool <span class="token operator">=</span> <span class="token class-name">ClassPool</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ctClass <span class="token operator">=</span> classPool<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>realClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 得到该类所有的方法实例，也可选择方法，进行增强</span>
                <span class="token class-name">CtMethod</span><span class="token punctuation">[</span><span class="token punctuation">]</span> declaredMethods <span class="token operator">=</span> ctClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CtMethod</span> method <span class="token operator">:</span> declaredMethods<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;方法被拦截&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    method<span class="token punctuation">.</span><span class="token function">addLocalVariable</span><span class="token punctuation">(</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CtClass</span><span class="token punctuation">.</span>longType<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    method<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token string">&quot;System.out.println(\&quot;---开始执行---\&quot;);&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    method<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token string">&quot;time = System.currentTimeMillis();&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    method<span class="token punctuation">.</span><span class="token function">insertAfter</span><span class="token punctuation">(</span><span class="token string">&quot;System.out.println(\&quot;---结束执行---\&quot;);&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    method<span class="token punctuation">.</span><span class="token function">insertAfter</span><span class="token punctuation">(</span><span class="token string">&quot;System.out.println(\&quot;运行耗时: \&quot; + (System.currentTimeMillis() - time));&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> ctClass<span class="token punctuation">.</span><span class="token function">toBytecode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//这里要用Throwable，不要用Exception</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> classfileBuffer<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>（4）输出</p> <p>指定 VM 参数 -javaagent:F:\code\myCode\agent-test\runtime-agent\target\runtime-agent-1.0-SNAPSHOT.jar=hello，运行 AppMain</p> <div class="language- extra-class"><pre class="language-text"><code>探针启动！！！
探针传入参数：hello
APP 启动！！！
拦截到的类名：io.github.dunwu.javacore.javaagent.AppInit
init方法被拦截
---开始执行---
APP初始化中...
---结束执行---
运行耗时: 1014
</code></pre></div><h4 id="运行时拦截-jdk-1-6-及以上"><a href="#运行时拦截-jdk-1-6-及以上" class="header-anchor">#</a> 运行时拦截（JDK 1.6 及以上）</h4> <p>如何实现在程序运行时去完成动态修改字节码呢？</p> <p>动态修改字节码需要依赖于 JDK 为我们提供的 JVM 工具，也就是上边我们提到的 Attach，通过它去加载我们的代理程序。</p> <p>首先我们在代理程序中需要定义一个名字为 agentmain 的方法，它可以和上边我们提到的 premain 是一样的内容，也可根据 agentmain 的特性进行自己逻辑的开发。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * agentmain 在 main 函数开始运行后才启动（依赖于Attach机制）
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunTimeAgent</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">agentmain</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">,</span> <span class="token class-name">Instrumentation</span> instrumentation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;agentmain探针启动！！！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;agentmain探针传入参数：&quot;</span> <span class="token operator">+</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        instrumentation<span class="token punctuation">.</span><span class="token function">addTransformer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunTimeTransformer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后就是我们需要将配置中设置，让其知道我们的探针需要加载这个类，在 maven 中设置如下，如果是 META-INF/MANIFEST.MF 文件同理。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--&lt;Premain-Class&gt;com.zhj.agent.agentmain.RunTimeAgent&lt;/Premain-Class&gt;--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Agent-Class</span><span class="token punctuation">&gt;</span></span>com.zhj.agent.agentmain.RunTimeAgent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Agent-Class</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这样其实我们的探针就已经改造好了，然后我们需要在目标程序的 main 方法中植入一些代码，使其可以读取到我们的代理程序，这样我们也无需去配置 JVM 的参数，就可以加载探针程序。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">APPMain</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;APP 启动！！！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">VirtualMachineDescriptor</span> vmd <span class="token operator">:</span> <span class="token class-name">VirtualMachine</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 指定的VM才可以被代理</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;该VM为指定代理的VM&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>vmd<span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">VirtualMachine</span> vm <span class="token operator">=</span> <span class="token class-name">VirtualMachine</span><span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>vmd<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    vm<span class="token punctuation">.</span><span class="token function">loadAgent</span><span class="token punctuation">(</span><span class="token string">&quot;D:/Code/java/idea_project/agent-test/runtime-agent/target/runtime-agent-1.0-SNAPSHOT.jar=hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    vm<span class="token punctuation">.</span><span class="token function">detach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">AppInit</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中 VirtualMachine 是 JDK 工具包下的类，如果系统环境变量没有配置，需要自己在 Maven 中引入本地文件。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.sun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>tools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>system<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>systemPath</span><span class="token punctuation">&gt;</span></span>D:/Software/java_dev/java_jdk/lib/tools.jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>systemPath</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这样我们在程序启动后再去动态修改字节码文件的简单案例就完成了。</p> <h2 id="字节码工具"><a href="#字节码工具" class="header-anchor">#</a> 字节码工具</h2> <ul><li><a href="https://plugins.jetbrains.com/plugin/9248-jclasslib-bytecode-viewer" target="_blank" rel="noopener noreferrer">jclasslib<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - IDEA 插件，可以直观查看当前字节码文件的类信息、常量池、方法区等信息。</li> <li><a href="https://github.com/zxh0/classpy" target="_blank" rel="noopener noreferrer">classpy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - Classpy 是一个用于研究 Java 类文件、Lua 二进制块、Wasm 二进制代码和其他二进制文件格式的 GUI 工具。</li> <li><a href="https://plugins.jetbrains.com/plugin/5918-asm-bytecode-outline" target="_blank" rel="noopener noreferrer">ASM ByteCode Outline<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - 利用 ASM 手写字节码时，需要利用一系列 visitXXXXInsn() 方法来写对应的助记符，所以需要先将每一行源代码转化为一个个的助记符，然后通过 ASM 的语法转换为 visitXXXXInsn() 这种写法。第一步将源码转化为助记符就已经够麻烦了，不熟悉字节码操作集合的话，需要我们将代码编译后再反编译，才能得到源代码对应的助记符。第二步利用 ASM 写字节码时，如何传参也很令人头疼。ASM 社区也知道这两个问题，所以提供了此工具。</li></ul> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><strong>书籍</strong> <ul><li><a href="https://book.douban.com/subject/34907497/" target="_blank" rel="noopener noreferrer">《深入理解 Java 虚拟机》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><strong>文章</strong> <ul><li><a href="https://tech.meituan.com/2019/09/05/java-bytecode-enhancement.html" target="_blank" rel="noopener noreferrer">字节码增强技术探索<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6844903588716609543" target="_blank" rel="noopener noreferrer">轻松看懂Java字节码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/7086026013498408973" target="_blank" rel="noopener noreferrer">Java Agent 探针技术<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li>字节码框架
<ul><li><a href="https://asm.ow2.io/" target="_blank" rel="noopener noreferrer">asm 官方<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/jboss-javassist/javassist" target="_blank" rel="noopener noreferrer">Javassist Github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/raphw/byte-buddy" target="_blank" rel="noopener noreferrer">Byte Buddy Github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/javacore/edit/master/docs/01.Java/01.JavaSE/06.JVM/05.JVM字节码.md" target="_blank" rel="noopener noreferrer">📝 帮助改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/javacore/tags/?tag=Java" title="标签">#Java</a><a href="/javacore/tags/?tag=JavaSE" title="标签">#JavaSE</a><a href="/javacore/tags/?tag=JVM" title="标签">#JVM</a><a href="/javacore/tags/?tag=%E5%AD%97%E8%8A%82%E7%A0%81" title="标签">#字节码</a><a href="/javacore/tags/?tag=javaagent" title="标签">#javaagent</a><a href="/javacore/tags/?tag=asm" title="标签">#asm</a><a href="/javacore/tags/?tag=javassist" title="标签">#javassist</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/09/13, 06:43:21</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/javacore/pages/17aad9/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">JVM 类加载</div></a> <a href="/javacore/pages/c590ae/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">JVM 命令行工具</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/javacore/pages/17aad9/" class="prev">JVM 类加载</a></span> <span class="next"><a href="/javacore/pages/c590ae/">JVM 命令行工具</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/javacore/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/javacore/pages/69d2f8/"><div>
            JavaSE
            <!----></div></a> <span class="date">05-06</span></dt></dl><dl><dd>02</dd> <dt><a href="/javacore/pages/496a7e/"><div>
            源码级深度理解 Java SPI
            <!----></div></a> <span class="date">04-26</span></dt></dl><dl><dd>03</dd> <dt><a href="/javacore/pages/2950ba/"><div>
            Java 基础语法特性
            <!----></div></a> <span class="date">01-25</span></dt></dl> <dl><dd></dd> <dt><a href="/javacore/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:forbreak@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/dunwu" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2024
    <span>钝悟（dunwu） | CC-BY-SA-4.0</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">×</span> <div>
    <div class="wwads-cn wwads-vertical windowRB" data-id="261" style="max-width:160px;
    min-width: auto;min-height:auto;"></div>
    <style>
      .windowRB{ padding: 0;}
      .windowRB .wwads-img{margin-top: 10px;}
      .windowRB .wwads-content{margin: 0 10px 40px 10px;}
      .custom-html-window-rb .close-but{
        display: none;
      }
    </style>
  </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/javacore/assets/js/app.44fc03ae.js" defer></script><script src="/javacore/assets/js/2.aded268b.js" defer></script><script src="/javacore/assets/js/56.e604e971.js" defer></script>
  </body>
</html>
